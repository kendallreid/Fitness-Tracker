<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Workouts</title>
  <style>
    :root {
      --crimson: #8C001A;
      --crimson-600: #a30020;
      --bg: #fafafa;
      --ink: #1a1a1a;
      --muted: #6b7280;
      --card: #ffffff;
      --border: #8c001a33;
      --shadow: rgba(140, 0, 26, 0.15);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; font-family: "Segoe UI", Roboto, sans-serif; background: var(--bg); color: var(--ink); }

    header {
      background: var(--crimson);
      color: #fff;
      padding: 16px;
      box-shadow: 0 3px 8px var(--shadow);
    }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 16px; }

    .title { font-weight: 800; font-size: 1.8rem; }
    .sub { color: #ffeaea; font-size: 14px; }

    nav {
      background: #fff;
      border-bottom: 2px solid var(--crimson);
      box-shadow: 0 1px 4px rgba(0,0,0,0.05);
    }
    .tabs { display: flex; gap: 8px; flex-wrap: wrap; padding: 10px 16px; justify-content: center; }
    .tab {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      border-radius: 999px;
      border: 1.5px solid var(--border);
      text-decoration: none;
      color: var(--crimson);
      font-weight: 600;
      background: #fff;
      transition: 0.2s;
    }
    .tab:hover { background: var(--crimson); color: white; }
    .tab.active { background: var(--crimson); color: #fff; border-color: var(--crimson); }

    main { padding: 30px 0; }
    .card {
      background: var(--card);
      border: 1.5px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 10px var(--shadow);
      margin-bottom: 24px;
    }
    .card h3 {
      margin: 0 0 12px;
      font-size: 1.4rem;
      color: var(--crimson);
      border-left: 4px solid var(--crimson);
      padding-left: 8px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
      margin-bottom: 16px;
    }
    input, select, button {
      padding: 10px;
      border: 1.5px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
    }
    button {
      background: var(--crimson);
      color: white;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover { background: var(--crimson-600); }

    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td {
      padding: 10px;
      border-bottom: 1px solid var(--border);
      text-align: left;
    }
    th {
      color: var(--crimson);
      background: #fef3f3;
      font-weight: 700;
    }
    tr:hover { background-color: #fff5f5; }

    footer {
      text-align: center;
      color: var(--muted);
      font-size: 12px;
      margin: 40px 0;
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="title">Workouts</div>
      <div class="sub">Track and review your exercise sessions.</div>
    </div>
  </header>

  <nav>
    <div class="wrap">
      <div class="tabs">
        <a class="tab" href="/index.html">Dashboard</a>
        <a class="tab" href="/food.html">Food</a>
        <a class="tab" href="/exercise.html">Exercise</a>
        <a class="tab" href="/goals.html">Goals</a>
        <a class="tab active" href="/workouts.html">Workouts</a>
        <a class="tab" href="/weekly.html">Weekly Log</a>
        <a class="tab" href="/profile.html">Profile</a>
      </div>
    </div>
  </nav>

  <main>
    <div class="wrap">
      <section class="card">
        <h3>Add Workout</h3>
        <form id="workoutForm" class="form-grid">
          <input type="text" id="type" placeholder="Type (e.g. Bench Press)" required>
          <input type="number" id="sets" placeholder="Sets" required>
          <input type="number" id="reps" placeholder="Reps" required>
          <input type="number" id="weight" placeholder="Weight (lbs)" required>
          <input type="number" id="duration" placeholder="Duration (min)">
          <input type="text" id="notes" placeholder="Notes">
          <button type="submit">Add</button>
        </form>
      </section>

      <section class="card">
        <h3>Workout Log</h3>
        <table>
          <thead>
            <tr>
              <th>Date</th><th>Type</th><th>Sets</th><th>Reps</th><th>Weight</th><th>Duration</th><th>Notes</th><th>Actions</th>
            </tr>
          </thead>
          <tbody id="workoutTableBody"></tbody>
        </table>
      </section>
    </div>
  </main>

  <footer>
    <p>Â© 2025 FitnessApp</p>
  </footer>

  <script>
    const API = "http://localhost:8080/api/workouts";
    const user_id = 1;


    function renderWorkouts(list) {
        const tbody = document.getElementById("workoutTableBody");
        tbody.innerHTML = "";

        list.forEach(w => {
            const row = document.createElement("tr");
            row.innerHTML = `
            <td>${w.date}</td>
            <td>${w.type}</td>
            <td>${w.sets}</td>
            <td>${w.reps}</td>
            <td>${w.weight}</td>
            <td>${w.duration}</td>
            <td>${w.notes}</td>
            <td>
                <button class="edit-btn">Edit</button>
                <button class="delete-btn" style="background:#aaa">Delete</button>
            </td>
            `;

            const [editBtn, deleteBtn] = row.querySelectorAll("button");

            // Delete listener
            deleteBtn.addEventListener("click", () => deleteWorkout(w.id));

            // Edit listener
            editBtn.addEventListener("click", () => {
            // Convert row cells to inputs
            const cells = row.querySelectorAll("td");
            cells[1].innerHTML = `<input value="${w.type}" />`;
            cells[2].innerHTML = `<input type="number" value="${w.sets}" />`;
            cells[3].innerHTML = `<input type="number" value="${w.reps}" />`;
            cells[4].innerHTML = `<input type="number" value="${w.weight}" />`;
            cells[5].innerHTML = `<input type="number" value="${w.duration}" />`;
            cells[6].innerHTML = `<input value="${w.notes}" />`;

            // Replace buttons with Save/Cancel
            cells[7].innerHTML = `
                <button class="save-btn" style="background:green">Save</button>
                <button class="cancel-btn" style="background:gray">Cancel</button>
            `;

            const saveBtn = row.querySelector(".save-btn");
            const cancelBtn = row.querySelector(".cancel-btn");

            saveBtn.addEventListener("click", async () => {
                const updated = {
                id: w.id,
                user_id,
                date: w.date, // keep same date
                type: cells[1].querySelector("input").value,
                sets: +cells[2].querySelector("input").value,
                reps: +cells[3].querySelector("input").value,
                weight: +cells[4].querySelector("input").value,
                duration: +cells[5].querySelector("input").value,
                notes: cells[6].querySelector("input").value
                };

                const res = await fetch(API, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(updated)
                });

                if (res.ok) {
                fetchWorkouts(); // reload table
                } else {
                const data = await res.json().catch(() => ({}));
                alert(`Failed to update workout: ${data.message || res.status}`);
                }
            });

            cancelBtn.addEventListener("click", () => fetchWorkouts());
            });

            tbody.appendChild(row);
        });
    }



    async function fetchWorkouts() {
        const res = await fetch(`${API}?user_id=${user_id}`);
        const data = await res.json();
        renderWorkouts(data.workouts); // call the renderer here
    }

    document.getElementById("workoutForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const workout = {
        user_id,
        date: new Date().toISOString().split("T")[0],
        type: document.getElementById("type").value,
        sets: +document.getElementById("sets").value,
        reps: +document.getElementById("reps").value,
        weight: +document.getElementById("weight").value,
        duration: +document.getElementById("duration").value || 0,
        notes: document.getElementById("notes").value
      };

      const res = await fetch(API, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(workout)
      });

      const json = await res.json();
      alert(json.message);
      e.target.reset();
      fetchWorkouts();
    });

    fetchWorkouts();

    // Delete a workout
    async function deleteWorkout(id) {
        if (!confirm("Are you sure you want to delete this workout?")) return;

        const res = await fetch(`${API}/${id}?user_id=${user_id}`, {
            method: "DELETE",
        });

        if (res.ok) {
            alert("Workout deleted successfully!");
            fetchWorkouts(); // refresh table
        } else {
            const data = await res.json().catch(() => ({}));
            alert(`Failed to delete workout: ${data.message || res.status}`);
        }
    }

    // Edit an existing workout
    async function editWorkout(w) {
        const newType = prompt("Type:", w.type);
        if (!newType) return; // cancelled

        const newSets = prompt("Sets:", w.sets);
        const newReps = prompt("Reps:", w.reps);
        const newWeight = prompt("Weight (kg):", w.weight);
        const newDuration = prompt("Duration (min):", w.duration);
        const newNotes = prompt("Notes:", w.notes || "");

        const updated = {
            id: w.id,
            user_id: user_id,
            date: new Date().toISOString().split("T")[0],
            type: newType,
            sets: +newSets,
            reps: +newReps,
            weight: +newWeight,
            duration: +newDuration,
            notes: newNotes
        };

        const res = await fetch(API, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(updated)
        });

        if (res.ok) {
            alert("Workout updated successfully!");
            fetchWorkouts();
        } else {
            const data = await res.json().catch(() => ({}));
            alert(`Failed to update workout: ${data.message || res.status}`);
        }
    }

  </script>
</body>
</html>
