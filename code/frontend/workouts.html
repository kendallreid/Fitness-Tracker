<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Workouts</title>
  <style>
    :root {
      --crimson: #8C001A;
      --crimson-600: #a30020;
      --bg: #fafafa;
      --ink: #1a1a1a;
      --muted: #6b7280;
      --card: #ffffff;
      --border: #8c001a33;
      --shadow: rgba(140, 0, 26, 0.15);
    }
    * { box-sizing: border-box; }
    html, body {
      height: 100%;
      margin: 0;
      font-family: "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      color: var(--ink);
    }
    header {
      background: var(--crimson);
      color: #fff;
      padding: 16px;
      box-shadow: 0 3px 8px var(--shadow);
    }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 16px; }
    .title { font-weight: 800; font-size: 1.8rem; }
    .sub { color: #ffeaea; font-size: 14px; }
    nav {
      background: #fff;
      border-bottom: 2px solid var(--crimson);
      box-shadow: 0 1px 4px rgba(0,0,0,0.05);
    }
    .tabs {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      padding: 10px 16px;
      justify-content: center;
    }
    .tab {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 8px 16px;
      border-radius: 999px;
      border: 1.5px solid var(--border);
      text-decoration: none;
      color: var(--crimson);
      font-weight: 600;
      background: #fff;
      transition: 0.2s;
    }
    .tab:hover { background: var(--crimson); color: white; }
    .tab.active { background: var(--crimson); color: #fff; border-color: var(--crimson); }

    main { padding: 30px 0; }
    .card {
      background: var(--card);
      border: 1.5px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 4px 10px var(--shadow);
      margin-bottom: 24px;
    }
    .card h3 {
      margin: 0 0 12px;
      font-size: 1.4rem;
      color: var(--crimson);
      border-left: 4px solid var(--crimson);
      padding-left: 8px;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 10px;
      margin-bottom: 16px;
    }

    input, select, button {
      padding: 10px;
      border: 1.5px solid var(--border);
      border-radius: 8px;
      font-size: 14px;
    }
    button {
      background: var(--crimson);
      color: white;
      font-weight: 600;
      border: none;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover { background: var(--crimson-600); }

    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td {
      padding: 10px;
      border-bottom: 1px solid var(--border);
      text-align: left;
    }
    th { color: var(--crimson); background: #fef3f3; font-weight: 700; }
    tr:hover { background-color: #fff5f5; }

    footer {
      text-align: center;
      color: var(--muted);
      font-size: 12px;
      margin: 40px 0;
    }

    .back-link {
      display: inline-block;
      margin-bottom: 16px;
      color: var(--crimson);
      font-weight: 600;
      text-decoration: none;
    }
    .back-link:hover { text-decoration: underline; }

    .edit-btn { background: #4b5563; color: #fff; margin-right: 6px; }
    .edit-btn:hover { background: #374151; }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="title">Workouts</div>
      <div id="sessionInfo" class="sub">Track and review your exercises.</div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <a href="/sessions" class="back-link">← Back to Sessions</a>

      <section class="card">
        <h3 id="formTitle">Add Workout</h3>
        <form id="workoutForm" class="form-grid">
          <input type="text" id="type" placeholder="Exercise Type (e.g. Bench Press)" required>
          <input type="number" id="sets" placeholder="Sets">
          <input type="number" id="reps" placeholder="Reps">
          <input type="number" id="weight" placeholder="Weight (lbs)">
          <input type="number" id="duration" placeholder="Duration (min)">
          <input type="text" id="notes" placeholder="Notes">
          <button type="submit" id="submitBtn">Add Workout</button>
        </form>
      </section>

      <section class="card">
        <h3>Workout Log</h3>
        <table>
          <thead>
            <tr>
              <th>Date</th><th>Type</th><th>Sets</th><th>Reps</th><th>Weight</th><th>Duration</th><th>Notes</th><th>Actions</th>
            </tr>
          </thead>
          <tbody id="workoutTableBody"></tbody>
        </table>
      </section>
    </div>
  </main>

  <footer>
    <p>© 2025 FitnessApp</p>
  </footer>

  <script>
    const API = "http://localhost:8080/api/workouts";
    const params = new URLSearchParams(window.location.search);
    const session_id = params.get("session_id");
    let editingId = null;

    // Display helper for -1/null → "N/A"
    const display = (v) => (v === null || v === -1 || v === "" ? "N/A" : v);

    const info = document.getElementById("sessionInfo");
    info.textContent = session_id
      ? `Viewing Workouts for Session #${session_id}`
      : "Viewing All Workouts";

    async function fetchWorkouts() {
      const url = session_id ? `${API}?session_id=${session_id}` : API;
      const res = await fetch(url, { credentials: "include" });
      if (!res.ok) {
        console.error("Failed to fetch workouts");
        return;
      }
      const data = await res.json();
      renderWorkouts(data.workouts);
    }

    function renderWorkouts(list) {
      const tbody = document.getElementById("workoutTableBody");
      tbody.innerHTML = "";
      list.forEach(w => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${w.date}</td>
          <td>${w.type}</td>
          <td>${display(w.sets)}</td>
          <td>${display(w.reps)}</td>
          <td>${display(w.weight)}</td>
          <td>${display(w.duration)}</td>
          <td>${w.notes || ""}</td>
          <td>
            <button class="edit-btn">Edit</button>
            <button class="delete-btn" style="background:#aaa">Delete</button>
          </td>
        `;

        // Edit button handler
        row.querySelector(".edit-btn").addEventListener("click", () => {
          editingId = w.id;
          document.getElementById("type").value = w.type;
          document.getElementById("sets").value = w.sets === -1 ? "" : w.sets;
          document.getElementById("reps").value = w.reps === -1 ? "" : w.reps;
          document.getElementById("weight").value = w.weight === -1 ? "" : w.weight;
          document.getElementById("duration").value = w.duration === -1 ? "" : w.duration;
          document.getElementById("notes").value = w.notes || "";
          document.getElementById("formTitle").textContent = "Edit Workout";
          document.getElementById("submitBtn").textContent = "Save Changes";
        });

        // Delete button handler
        row.querySelector(".delete-btn").addEventListener("click", () => deleteWorkout(w.id));

        tbody.appendChild(row);
      });
    }

    // Add or edit workout
    document.getElementById("workoutForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const workout = {
        id: editingId,
        session_id: session_id ? +session_id : 0,
        date: new Date().toISOString().split("T")[0],
        type: document.getElementById("type").value,
        sets: +document.getElementById("sets").value || -1,
        reps: +document.getElementById("reps").value || -1,
        weight: +document.getElementById("weight").value || -1,
        duration: +document.getElementById("duration").value || -1,
        notes: document.getElementById("notes").value
      };

      const method = editingId ? "PUT" : "POST";
      const res = await fetch(API, {
        method,
        headers: { "Content-Type": "application/json" },
        credentials: "include",
        body: JSON.stringify(workout)
      });

      if (res.ok) {
        e.target.reset();
        editingId = null;
        document.getElementById("formTitle").textContent = "Add Workout";
        document.getElementById("submitBtn").textContent = "Add Workout";
        fetchWorkouts();
      } else {
        alert("Failed to save workout.");
      }
    });

    async function deleteWorkout(id) {
      if (!confirm("Delete this workout?")) return;
      const res = await fetch(`${API}/${id}`, { method: "DELETE", credentials: "include" });
      if (res.ok) {
        fetchWorkouts();
      } else {
        alert("Failed to delete workout.");
      }
    }

    fetchWorkouts();
  </script>
</body>
</html>
