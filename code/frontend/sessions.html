<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sessions</title>
  <style>
    :root {
      --crimson: #8C001A;
      --crimson-dark: #6b0014;
      --bg: #f7f8fa;
      --card: #ffffff;
      --border: #ddd;
      --muted: #666;
      --shadow: rgba(0, 0, 0, 0.1);
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Segoe UI", Roboto, sans-serif;
      background: var(--bg);
      color: #222;
    }

    header {
      background: var(--crimson);
      color: #fff;
      padding: 1.2rem 0;
      box-shadow: 0 2px 6px var(--shadow);
    }

    .wrap {
      max-width: 1000px;
      margin: 0 auto;
      padding: 0 1rem;
    }

    header .title { font-size: 1.8rem; font-weight: bold; }
    header .sub { opacity: 0.9; font-size: 0.95rem; }

    nav {
      background: #fff;
      border-bottom: 2px solid var(--crimson);
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
      padding: 0.8rem 0;
    }

    .tab {
      text-decoration: none;
      padding: 0.5rem 1.2rem;
      border-radius: 999px;
      border: 1.5px solid var(--crimson);
      color: var(--crimson);
      font-weight: 600;
      background: #fff;
      transition: 0.2s;
    }

    .tab:hover { background: var(--crimson); color: #fff; }
    .tab.active { background: var(--crimson); color: #fff; }

    main { padding: 2rem 1rem; }

    .card {
      background: var(--card);
      border-radius: 12px;
      box-shadow: 0 2px 8px var(--shadow);
      padding: 1.5rem;
      margin-bottom: 2rem;
      border-top: 3px solid var(--crimson);
    }

    .card h3 {
      margin: 0 0 1rem;
      color: var(--crimson);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
    }

    input, button {
      padding: 0.8rem;
      font-size: 1rem;
      border-radius: 6px;
      border: 1.5px solid #ccc;
    }

    input:focus {
      outline: none;
      border-color: var(--crimson);
      box-shadow: 0 0 0 2px rgba(140, 0, 26, 0.1);
    }

    button {
      background: var(--crimson);
      color: #fff;
      border: none;
      cursor: pointer;
      transition: 0.2s;
      font-weight: 600;
    }

    button:hover { background: var(--crimson-dark); }

    .see-all-btn {
      display: none;
      margin-top: 1rem;
      width: 100%;
      background: var(--crimson);
      color: #fff;
      font-weight: 600;
      border-radius: 8px;
      padding: 0.8rem;
      border: none;
      cursor: pointer;
      transition: 0.2s;
    }

    .see-all-btn:hover { background: var(--crimson-dark); }

    .sort-btn {
      background: #fff;
      color: var(--crimson);
      border: 1.5px solid var(--crimson);
      border-radius: 8px;
      padding: 0.5rem 0.9rem;
      font-size: 0.9rem;
      cursor: pointer;
      transition: 0.2s;
    }

    .sort-btn:hover {
      background: var(--crimson);
      color: #fff;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    th, td {
      padding: 0.8rem;
      border-bottom: 1px solid #eee;
      text-align: left;
    }

    th {
      background: #faf0f2;
      color: var(--crimson);
      font-weight: 700;
    }

    tr:hover { background: #fff6f7; }

    .delete-btn {
      background: #aaa;
      border: none;
      color: white;
      border-radius: 6px;
      padding: 0.4rem 0.8rem;
      cursor: pointer;
      transition: 0.2s;
    }

    .delete-btn:hover { background: #888; }

    footer {
      text-align: center;
      color: var(--muted);
      font-size: 0.8rem;
      padding: 2rem 0;
    }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <div class="title">Exercise Sessions</div>
      <div class="sub">Create, view, and manage your fitness sessions.</div>
    </div>
  </header>

  <nav>
    <div class="tabs">
      <a class="tab" href="/food.html">Food</a>
      <a class="tab active" href="/sessions.html">Exercise</a>
      <a class="tab" href="/goals.html">Goals</a>
      <a class="tab" href="/weekly.html">Weekly Log</a>
      <a class="tab" href="/profile.html">Profile</a>
      <a class="tab" href="/social.html">Social</a>
      <a class="tab" href="/notifications.html">Notifications</a>
    </div>
  </nav>

  <main>
    <div class="wrap">
      <section class="card">
        <h3>Create a New Session</h3>
        <form id="sessionForm" class="form-grid">
          <input type="text" id="name" placeholder="Session Name (e.g. Push Day)" required />
          <input type="date" id="date" required />
          <input type="text" id="notes" placeholder="Notes (optional)" />
          <input type="number" id="duration" placeholder="Duration (min)" />
          <button type="submit">Add Session</button>
        </form>
      </section>

      <section class="card">
        <h3>
          Your Sessions
          <button id="sortBtn" class="sort-btn">Sort: Newest → Oldest</button>
        </h3>

        <table>
          <thead>
            <tr>
              <th>Name</th>
              <th>Date</th>
              <th>Notes</th>
              <th>Duration</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="sessionTableBody"></tbody>
        </table>

        <button id="seeAllBtn" class="see-all-btn">See All</button>
      </section>
    </div>
  </main>

  <footer>
    <p>© 2025 FitnessApp</p>
  </footer>

  <script>
    const API = "http://localhost:8080/api/sessions";
    let showingAll = false;
    let allSessions = [];
    let sortAscending = false; // default newest → oldest

    async function fetchSessions() {
      const res = await fetch(`${API}/user`, { credentials: "include" });
      if (!res.ok) {
        console.error("Failed to fetch sessions");
        return;
      }
      const data = await res.json();
      allSessions = data.sessions || [];
      renderSessions();
    }

    function renderSessions() {
      const tbody = document.getElementById("sessionTableBody");
      const seeAllBtn = document.getElementById("seeAllBtn");
      const sortBtn = document.getElementById("sortBtn");
      tbody.innerHTML = "";

      if (allSessions.length === 0) {
        tbody.innerHTML = `<tr><td colspan="5" style="text-align:center;color:#666">No sessions yet.</td></tr>`;
        seeAllBtn.style.display = "none";
        return;
      }

      // Sort sessions by date
      allSessions.sort((a, b) => {
        const dateA = new Date(a.date);
        const dateB = new Date(b.date);
        return sortAscending ? dateA - dateB : dateB - dateA;
      });

      // Toggle sort button label
      sortBtn.textContent = sortAscending ? "Sort: Oldest → Newest" : "Sort: Newest → Oldest";

      const visibleSessions = showingAll ? allSessions : allSessions.slice(0, 7);

      visibleSessions.forEach((s) => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${s.name}</td>
          <td>${s.date}</td>
          <td>${s.notes || "N/A"}</td>
          <td>${s.duration || "N/A"}</td>
          <td><button class="delete-btn">Delete</button></td>
        `;

        row.addEventListener("click", (e) => {
          if (e.target.classList.contains("delete-btn")) return;
          window.location.href = `exercises.html?session_id=${s.id}`;
        });

        row.querySelector(".delete-btn").addEventListener("click", async () => {
          if (!confirm("Delete this session?")) return;
          const res = await fetch(`${API}/${s.id}`, { method: "DELETE", credentials: "include" });
          if (res.ok) fetchSessions();
          else alert("Failed to delete session.");
        });

        tbody.appendChild(row);
      });

      seeAllBtn.style.display = allSessions.length > 7 ? "block" : "none";
      seeAllBtn.textContent = showingAll ? "Show Less" : "See All";
    }

    document.getElementById("sortBtn").addEventListener("click", () => {
      sortAscending = !sortAscending;
      renderSessions();
    });

    document.getElementById("seeAllBtn").addEventListener("click", () => {
      showingAll = !showingAll;
      renderSessions();
    });

    document.getElementById("sessionForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const session = {
        name: document.getElementById("name").value,
        date: document.getElementById("date").value,
        notes: document.getElementById("notes").value,
        duration: +document.getElementById("duration").value || 0,
      };
      const res = await fetch(`${API}/create`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        credentials: "include",
        body: JSON.stringify(session),
      });
      if (res.ok) {
        e.target.reset();
        fetchSessions();
      } else {
        alert("Failed to create session.");
      }
    });

    fetchSessions();
  </script>
</body>
</html>

